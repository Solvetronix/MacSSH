# Full Disk Access Implementation

## Обзор

Добавлена полная поддержка проверки и запроса разрешения Full Disk Access для приложения MacSSH.

## Что было добавлено

### 1. Новый сервис PermissionsService.swift

Создан новый сервис `PermissionsService` со следующими возможностями:

- **checkFullDiskAccess()** - проверяет наличие разрешения Full Disk Access
- **requestFullDiskAccess()** - запрашивает разрешение через диалог
- **openSystemPreferences()** - открывает System Settings на странице Privacy & Security
- **checkAllPermissions()** - проверяет все системные разрешения
- **canExecuteExternalCommands()** - проверяет возможность выполнения внешних команд

### 2. Обновлен SSHService

- Добавлена проверка Full Disk Access в методы `connectToServer()` и `openTerminal()`
- Обновлен метод `checkAllPermissions()` для включения проверки системных разрешений
- Добавлены рекомендации по предоставлению Full Disk Access

### 3. Обновлен PermissionsManagerView

- Добавлена кнопка "Request Full Disk Access" для запроса разрешения
- Добавлена кнопка "Show Instructions" для показа подробных инструкций
- Автоматическая проверка Full Disk Access при открытии окна
- Кликабельные строки для запроса разрешений
- Автоматическое обновление статуса после запроса разрешений

### 4. Обновлен ProfileViewModel

- Добавлена проверка Full Disk Access при запуске приложения
- Обновлена логика показа предупреждений о разрешениях

### 5. Обновлены инструкции

- Обновлены инструкции для новых версий macOS (System Settings вместо System Preferences)
- Добавлено подчеркивание важности Full Disk Access
- Улучшены описания шагов

## Как это работает

### Проверка Full Disk Access

1. **Проверка доступа к системным директориям** - проверяется доступ к `/System/Library/CoreServices`, `/usr/bin`, `/usr/sbin`
2. **Проверка через команду ls** - выполняется команда `ls /System/Library/CoreServices` для проверки реального доступа
3. **Fallback проверки** - если команды не выполняются, считается что разрешения нет

### Запрос разрешения

1. **Показ диалога** - пользователю показывается диалог с объяснением необходимости разрешения
2. **Открытие System Settings** - при нажатии "Open System Settings" открывается соответствующая страница
3. **Поддержка старых версий** - автоматический fallback на System Preferences для старых версий macOS

### Интеграция в UI

1. **Автоматическая проверка** - при открытии PermissionsManagerView автоматически проверяется статус
2. **Кликабельные элементы** - строки с предупреждениями о разрешениях можно кликать для запроса
3. **Динамическое обновление** - статус обновляется после запроса разрешений
4. **Визуальная обратная связь** - кнопки отключаются когда разрешения уже предоставлены

## Использование

### Для пользователей

1. При первом запуске приложения появится предупреждение о необходимости разрешений
2. В SSH Tools Manager можно увидеть статус Full Disk Access
3. Можно кликнуть на предупреждение или кнопку "Request Full Disk Access" для запроса
4. System Settings откроется автоматически на нужной странице
5. После предоставления разрешения статус обновится автоматически

### Для разработчиков

```swift
// Проверка Full Disk Access
let hasAccess = PermissionsService.checkFullDiskAccess()

// Запрос разрешения
PermissionsService.requestFullDiskAccess()

// Проверка всех разрешений
let permissions = PermissionsService.checkAllPermissions()
```

## Совместимость

- Поддерживает macOS 13.0+ (System Settings)
- Автоматический fallback для старых версий (System Preferences)
- Работает с различными архитектурами (Intel/Apple Silicon)

## Безопасность

- Проверки выполняются безопасно без нарушения sandbox
- Запросы разрешений происходят через стандартные API macOS
- Нет прямого доступа к системным файлам без разрешения
